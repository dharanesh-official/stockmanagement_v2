// Simplified Inventory & Sales Management Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------------------------------------------------
// ENUMS & TYPES
// --------------------------------------------------------

enum UserRole {
  ADMIN
  SALES_PERSON
}

enum OrderStatus {
  ORDER // Add or Edit Order
  SALES // Add or Edit Sales
  CREDIT_NOTE // Add or Edit Credit Note
}

enum InvoiceStatus {
  UNPAID
  PARTIALLY_PAID
  PAID
  OVERDUE
  CANCELLED
}

// --------------------------------------------------------
// CORE MODELS
// --------------------------------------------------------

model User {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String
  fullName     String
  role         UserRole
  isActive     Boolean   @default(true)
  lastLoginAt  DateTime?

  salesOrders Order[]   @relation("SalesPerson")
  payments    Payment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}

model Product {
  id          String  @id @default(uuid())
  sku         String  @unique
  name        String
  description String?

  // Pricing
  basePrice Decimal  @db.Decimal(10, 2)
  costPrice Decimal? @db.Decimal(10, 2)

  imageUrl String?
  unit     String  @default("pcs")
  barcode  String?

  minStockLevel Int @default(10)
  quantity      Int @default(0) // Simplified Stock (Stock Maintenance)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Customer {
  id          String  @id @default(uuid())
  fullName    String
  phoneNumber String?
  email       String? @unique
  address     String?
  isLocked    Boolean @default(false) // Lock Customer feature

  orders   Order[]
  payments Payment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id          String @id @default(uuid())
  orderNumber String @unique

  customerId String
  customer   Customer @relation(fields: [customerId], references: [id])

  salesPersonId String
  salesPerson   User   @relation("SalesPerson", fields: [salesPersonId], references: [id])

  type           OrderStatus @default(ORDER)
  totalAmount    Decimal     @db.Decimal(10, 2)
  discountAmount Decimal     @db.Decimal(10, 2)

  items   OrderItem[]
  invoice Invoice?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  payments Payment[]
}

model OrderItem {
  id      String @id @default(uuid())
  orderId String
  order   Order  @relation(fields: [orderId], references: [id])

  productId   String
  productName String
  sku         String

  quantity   Int
  unitPrice  Decimal @db.Decimal(10, 2)
  totalPrice Decimal @db.Decimal(10, 2)
}

model Invoice {
  id            String @id @default(uuid())
  invoiceNumber String @unique

  orderId String @unique
  order   Order  @relation(fields: [orderId], references: [id])

  amount     Decimal       @db.Decimal(10, 2)
  paidAmount Decimal       @default(0) @db.Decimal(10, 2)
  status     InvoiceStatus @default(UNPAID)

  issuedAt DateTime  @default(now())
  dueDate  DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Payment {
  id            String @id @default(uuid())
  paymentNumber String @unique

  orderId String?
  order   Order?  @relation(fields: [orderId], references: [id])

  customerId String
  customer   Customer @relation(fields: [customerId], references: [id])

  amount        Decimal  @db.Decimal(10, 2)
  paymentDate   DateTime @default(now())
  paymentMethod String? // Cash, Cheque, etc.
  reference     String?

  collectedById String
  collectedBy   User   @relation(fields: [collectedById], references: [id])

  createdAt DateTime @default(now())
}
